{"version":3,"file":"js/addon-entry-debugger.js","sources":["webpack://GUI/./src/addons/addons/debugger/style.css","webpack://GUI/./src/addons/addons/debugger/add.svg","webpack://GUI/./src/addons/addons/debugger/debug-unread.svg","webpack://GUI/./src/addons/addons/debugger/debug.svg","webpack://GUI/./src/addons/addons/debugger/delete.svg","webpack://GUI/./src/addons/addons/debugger/download-white.svg","webpack://GUI/./src/addons/addons/debugger/error.svg","webpack://GUI/./src/addons/addons/debugger/play.svg","webpack://GUI/./src/addons/addons/debugger/warning.svg","webpack://GUI/./src/addons/addons/debugger/_runtime_entry.js","webpack://GUI/./src/addons/addons/debugger/userscript.js","webpack://GUI/./src/addons/libraries/common/cs/download-blob.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"[dir=\\\"ltr\\\"] .sa-debugger-container {\\n  margin-right: 0.2rem;\\n}\\n\\n[dir=\\\"rtl\\\"] .sa-debugger-container {\\n  margin-left: 0.2rem;\\n}\\n\\n.sa-debugger-small .sa-debugger-container {\\n  display: none !important;\\n}\\n\\n.debug {\\n  display: none;\\n}\\n.debug {\\n  position: absolute;\\n  z-index: 492;\\n  background-color: white;\\n  width: 400px;\\n  height: 25rem;\\n}\\n\\n.debug h1 {\\n  padding: 10px;\\n  cursor: move;\\n  z-index: 10;\\n  color: #fff !important;\\n  width: calc(100% - 20px);\\n  font-size: 20px;\\n}\\n\\n.sa-debugger-unpause {\\n  animation: unpauseBackground 2s infinite alternate;\\n}\\n@keyframes unpauseBackground /* Firefox */ {\\n  0% {\\n    background-color: rgba(0, 0, 0, 0.15);\\n  }\\n  100% {\\n    background-color: rgba(0, 0, 0, 0);\\n  }\\n}\\n.sa-debugger-unpause > img {\\n  width: 20px;\\n  height: 20px;\\n}\\n\\n.log {\\n  --message-border-color: rgba(0, 0, 0, 0.15);\\n  --warning-border-color: hsl(50deg 100% 88%);\\n  --error-border-color: hsl(0deg 100% 92%);\\n  --error-text-color: red;\\n  --monospace-font-size: 12px;\\n  --monospace-font-family: consolas, lucida console, courier new, monospace;\\n  --source-code-font-size: 12px;\\n  --source-code-font-family: consolas, lucida console, courier new, monospace;\\n  font-family: var(--monospace-font-family);\\n  font-size: var(--monospace-font-size) !important;\\n  word-wrap: break-word;\\n  user-select: text;\\n  box-sizing: border-box;\\n  min-width: 0;\\n  min-height: 0;\\n  display: flex;\\n  border-top: 1px solid var(--message-border-color);\\n  border-bottom: 1px solid var(--message-border-color);\\n  word-wrap: break-word;\\n  white-space: pre-wrap;\\n  flex: auto;\\n  line-height: 1.2;\\n  border-top-right-radius: revert;\\n  border-top-left-radius: revert;\\n  cursor: text;\\n  align-items: center;\\n  padding: 3px;\\n  color: #575e75;\\n  content-visibility: auto;\\n  contain-intrinsic-size: 1.2rem;\\n}\\n.warn {\\n  border-color: var(--warning-border-color);\\n  color: hsl(39deg 100% 18%);\\n  background-color: hsl(50deg 100% 95%);\\n}\\n.error {\\n  border-color: var(--error-border-color);\\n  color: var(--error-text-color);\\n  background-color: hsl(0deg 100% 95%);\\n}\\n.log:not(.warn):not(.error) + .log:not(.warn):not(.error),\\n.warn + .warn,\\n.error + .error {\\n  border-top-color: transparent;\\n}\\n.logs {\\n  border-radius: 0;\\n  padding: 0;\\n}\\n.extra-log-container {\\n  display: flex;\\n  flex-direction: column;\\n  overflow: auto;\\n  flex: 1;\\n  cursor: default;\\n  width: 100%;\\n}\\n.console-variable {\\n  padding: 4px;\\n  border-radius: 10px;\\n  color: white;\\n  margin-right: 5px;\\n}\\n.log > span:not(.console-variable) {\\n  flex-grow: 1;\\n}\\n.log a {\\n  color: inherit;\\n  opacity: 0.5;\\n  text-decoration: underline;\\n  float: right;\\n  text-align: right;\\n  max-width: 100%;\\n  padding-left: 4px;\\n  margin-right: 4px;\\n  margin-left: auto;\\n}\\n.log a:hover {\\n  color: #4d97ff;\\n  opacity: 1;\\n}\\n\\n.logLink.deletedTarget {\\n  pointer-events: none;\\n}\\n\\n.logIcon {\\n  width: 1rem;\\n  height: 1rem;\\n  margin: 0 0.25rem;\\n}\\n\\n.log:not(.warn):not(.error) {\\n  margin-left: 1.5rem;\\n}\\n\", \"\"]);\n\n// exports\n","export default \"data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDcuNDggNy40OCI+PHBhdGggZD0iTTMuNzQgNi40OFYxTTEgMy43NGg1LjQ4IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4Ii8+PC9zdmc+\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU3NWU3NSIgdmlld0JveD0iMCAwIDIwIDIwIj48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Im00LjUgNi41IDQuNSAzLTQuNSAzbTYgMGg1Ii8+PGNpcmNsZSBmaWxsPSIjNEM5N0ZGIiBjeD0iMTYiIGN5PSI0IiByPSIzIiBzdHJva2U9Im5vbmUiLz48cGF0aCBkPSJNMTguNSA4djcuNWMwIDEuMTA4LS44OTIgMi0yIDJoLTEzYy0xLjEwOCAwLTItLjg5Mi0yLTJ2LTExYzAtMS4xMDguODkyLTIgMi0ySDEyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=\"","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNEM5N0ZGIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggc3R5bGU9ImZpbGw6IzU3NWU3NTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTtwYWludC1vcmRlcjptYXJrZXJzIHN0cm9rZSBmaWxsIiBkPSJNNCAzLjVjLS44MzEgMC0xLjUuNjY5LTEuNSAxLjV2MTBjMCAuODMxLjY2OSAxLjUgMS41IDEuNWgxMmMuODMxIDAgMS41LS42NjkgMS41LTEuNVY1YzAtLjgzMS0uNjY5LTEuNS0xLjUtMS41Wm0wIDFoMTJjLjI3NyAwIC41LjIyMy41LjV2MTBjMCAuMjc3LS4yMjMuNS0uNS41SDRhLjQ5OS40OTkgMCAwIDEtLjUtLjVWNWMwLS4yNzcuMjIzLS41LjUtLjVaIiBzdHJva2U9Im5vbmUiLz48cGF0aCBkPSJtNS40MTcgNy41IDMuNzUgMi41LTMuNzUgMi41bTUgMGg0LjE2NiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzhmOGY4ZjtzdHJva2Utd2lkdGg6MTtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIi8+PC9nPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGQ9Ik00LjU0OCA3aDEwLjkwNGEuNS41IDAgMCAxIC40OTguNTQ1bC0uNzg1IDguNjM1QTIgMiAwIDAgMSAxMy4xNzQgMThINi44MjdhMiAyIDAgMCAxLTEuOTkyLTEuODJMNC4wNSA3LjU0NkEuNS41IDAgMCAxIDQuNTQ4IDd6bTIuNzg1LTMgLjU1My0xLjY1OEEuNS41IDAgMCAxIDguMzYgMmgzLjI4YS41LjUgMCAwIDEgLjQ3NC4zNDJMMTIuNjY3IDRIMTYuNWEuNS41IDAgMCAxIC41LjV2MWEuNS41IDAgMCAxLS41LjVoLTEzYS41LjUgMCAwIDEtLjUtLjV2LTFhLjUuNSAwIDAgMSAuNS0uNWgzLjgzM3ptMS4wNTQgMGgzLjIyNmwtLjMzNC0xSDguNzIxbC0uMzM0IDF6TTEwIDExLjcybDEuNTk1LTEuNTk1YS41LjUgMCAwIDEgLjcwNyAwbC4wNzMuMDczYS41LjUgMCAwIDEgMCAuNzA3TDEwLjc4IDEyLjVsMS41OTUgMS41OTVhLjUuNSAwIDAgMSAwIC43MDdsLS4wNzMuMDczYS41LjUgMCAwIDEtLjcwNyAwTDEwIDEzLjI4bC0xLjU5NSAxLjU5NWEuNS41IDAgMCAxLS43MDcgMGwtLjA3My0uMDczYS41LjUgMCAwIDEgMC0uNzA3TDkuMjIgMTIuNWwtMS41OTUtMS41OTVhLjUuNSAwIDAgMSAwLS43MDdsLjA3My0uMDczYS41LjUgMCAwIDEgLjcwNyAwTDEwIDExLjcyeiIgaWQ9ImEiLz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48bWFzayBpZD0iYiIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48ZyBtYXNrPSJ1cmwoI2IpIiBmaWxsPSIjRkZGIj48cGF0aCBkPSJNMCAwaDIwdjIwSDB6Ii8+PC9nPjwvZz48L3N2Zz4=\"","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE0LjczIDguNzc5LTQuMjUzIDQuMjY0YS42MTkuNjE5IDAgMCAxLS44OSAwTDUuMzM2IDguNzc5QS42My42MyAwIDAgMSA1Ljc4OCA3LjdoMi4xMTdsMS4yNjMtNS4wMTZhLjkxMi45MTIgMCAwIDEgMS4xMDYtLjY1Ni44OS44OSAwIDAgMSAuNjY4LjY1NkwxMi4yMDYgNy43aDIuMDcyYy41NTkgMCAuODU2LjY3LjQ1MSAxLjA3OHpNMTggMTEuODEydjIuNTc5QzE4IDE2LjM3NSAxNi4zOTUgMTggMTQuNDE3IDE4SDUuNkEzLjYwNyAzLjYwNyAwIDAgMSAyIDE0LjM5di0yLjU3OGExLjE3IDEuMTcgMCAxIDEgMi4zMzcgMHYyLjU3OUExLjI3IDEuMjcgMCAwIDAgNS42IDE1LjY1Nmg4LjgxN2MuNjg2IDAgMS4yNDYtLjU3OCAxLjI0Ni0xLjI2NXYtMi41NzljMC0uNjU2LjUzLTEuMTcyIDEuMTY5LTEuMTcyLjY1NCAwIDEuMTY4LjUxNiAxLjE2OCAxLjE3MnoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHN0eWxlPSItbXMtdHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpOy13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO3RyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKSI+PHBhdGggZD0iTTEyIDE0YTEuMjUgMS4yNSAwIDEgMCAxLjI1IDEuMjVBMS4yNSAxLjI1IDAgMCAwIDEyIDE0em0wLTEuNWExIDEgMCAwIDAgMS0xdi0zYTEgMSAwIDAgMC0yIDB2M2ExIDEgMCAwIDAgMSAxek0xMiAyYTEwIDEwIDAgMSAwIDEwIDEwQTEwLjAxMSAxMC4wMTEgMCAwIDAgMTIgMnptMCAxOGE4IDggMCAxIDEgOC04IDguMDEgOC4wMSAwIDAgMS04IDh6IiBmaWxsPSJyZWQiLz48L3N2Zz4=\"","export default \"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDkiIGhlaWdodD0iNTIiIHZpZXdCb3g9Ii01IDAgNDkgNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxkZWZzPjxwYXRoIGQ9Ik0xNy4yMjEgOC4zNDVjMi41NTYtNC4yNTkgNi43MDItNC4yNTIgOS4yNTQgMGwxMy42NzcgMjIuNzk2YzIuNTU1IDQuMjU4LjU5NyA3LjcxLTQuMzggNy43MUg3LjkyNGMtNC45NzMgMC02LjkzLTMuNDU4LTQuMzgtNy43MUwxNy4yMjIgOC4zNDV6IiBpZD0iYSIvPjwvZGVmcz48dXNlIHN0cm9rZT0iI0ZGRiIgZmlsbD0iI0ZGRiIgeGxpbms6aHJlZj0iI2EiIHRyYW5zZm9ybT0icm90YXRlKDkwIDIwLjg1IDIzLjAwMykiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiIHN0eWxlPSItbXMtdHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpOy13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO3RyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKSI+PHBhdGggZD0iTTEyIDE2YTEgMSAwIDEgMCAxIDEgMSAxIDAgMCAwLTEtMXptMTAuNjcgMS40Ny04LjA1LTE0YTMgMyAwIDAgMC01LjI0IDBsLTggMTRBMyAzIDAgMCAwIDMuOTQgMjJoMTYuMTJhMyAzIDAgMCAwIDIuNjEtNC41M3ptLTEuNzMgMmExIDEgMCAwIDEtLjg4LjUxSDMuOTRhMSAxIDAgMCAxLS44OC0uNTEgMSAxIDAgMCAxIDAtMWw4LTE0YTEgMSAwIDAgMSAxLjc4IDBsOC4wNSAxNGExIDEgMCAwIDEgLjA1IDEuMDJ6TTEyIDhhMSAxIDAgMCAwLTEgMXY0YTEgMSAwIDAgMCAyIDBWOWExIDEgMCAwIDAtMS0xeiIgZmlsbD0iI2UwYmIwMCIvPjwvc3ZnPg==\"","/* generated by pull.js */\nimport _import0 from \"./userscript.js\";\nimport _import1 from \"!css-loader!./style.css\";\nexport const resources = {\n  \"userscript.js\": _import0,\n  \"style.css\": _import1,\n};\n","/* inserted by pull.js */\nimport _twAsset0 from \"!url-loader!./add.svg\";\nimport _twAsset1 from \"!url-loader!./debug-unread.svg\";\nimport _twAsset2 from \"!url-loader!./debug.svg\";\nimport _twAsset3 from \"!url-loader!./delete.svg\";\nimport _twAsset4 from \"!url-loader!./download-white.svg\";\nimport _twAsset5 from \"!url-loader!./error.svg\";\nimport _twAsset6 from \"!url-loader!./play.svg\";\nimport _twAsset7 from \"!url-loader!./warning.svg\";\nconst _twGetAsset = (path) => {\n  if (path === \"/add.svg\") return _twAsset0;\n  if (path === \"/debug-unread.svg\") return _twAsset1;\n  if (path === \"/debug.svg\") return _twAsset2;\n  if (path === \"/delete.svg\") return _twAsset3;\n  if (path === \"/download-white.svg\") return _twAsset4;\n  if (path === \"/error.svg\") return _twAsset5;\n  if (path === \"/play.svg\") return _twAsset6;\n  if (path === \"/warning.svg\") return _twAsset7;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport downloadBlob from \"../../libraries/common/cs/download-blob.js\";\nimport { paused, setPaused, onPauseChanged } from \"./../pause/module.js\";\n\nexport default async function ({ addon, global, console, msg }) {\n  let showingConsole, ScratchBlocks;\n  const vm = addon.tab.traps.vm;\n\n  const container = document.createElement(\"div\");\n  container.className = \"sa-debugger-container\";\n  const buttonContainer = document.createElement(\"div\");\n  buttonContainer.className = addon.tab.scratchClass(\"button_outlined-button\", \"stage-header_stage-button\");\n  const buttonContent = document.createElement(\"div\");\n  buttonContent.className = addon.tab.scratchClass(\"button_content\");\n  const buttonImage = document.createElement(\"img\");\n  buttonImage.className = addon.tab.scratchClass(\"stage-header_stage-button-icon\");\n  buttonImage.draggable = false;\n  buttonImage.src = _twGetAsset(\"/debug.svg\");\n  buttonContent.appendChild(buttonImage);\n  buttonContainer.appendChild(buttonContent);\n  container.appendChild(buttonContainer);\n  buttonContainer.addEventListener(\"click\", () => toggleConsole(true));\n\n  let hasLoggedPauseError = false;\n\n  const pause = (_, thread) => {\n    if (addon.tab.redux.state.scratchGui.mode.isPlayerOnly) {\n      if (!hasLoggedPauseError) {\n        addLog(msg(\"cannot-pause-player\"), thread, \"error\");\n        hasLoggedPauseError = true;\n      }\n      return;\n    }\n    setPaused(!paused);\n    const pauseAddonButton = document.querySelector(\".pause-btn\");\n    if (!pauseAddonButton || getComputedStyle(pauseAddonButton).display === \"none\") toggleConsole(true);\n  };\n  addon.tab.addBlock(\"\\u200B\\u200Bbreakpoint\\u200B\\u200B\", {\n    args: [],\n    displayName: msg(\"block-breakpoint\"),\n    callback: pause,\n  });\n  addon.tab.addBlock(\"\\u200B\\u200Blog\\u200B\\u200B %s\", {\n    args: [\"content\"],\n    displayName: msg(\"block-log\"),\n    callback: ({ content }, thread) => {\n      addLog(content, thread, \"log\");\n    },\n  });\n  addon.tab.addBlock(\"\\u200B\\u200Bwarn\\u200B\\u200B %s\", {\n    args: [\"content\"],\n    displayName: msg(\"block-warn\"),\n    callback: ({ content }, thread) => {\n      addLog(content, thread, \"warn\");\n    },\n  });\n  addon.tab.addBlock(\"\\u200B\\u200Berror\\u200B\\u200B %s\", {\n    args: [\"content\"],\n    displayName: msg(\"block-error\"),\n    callback: ({ content }, thread) => {\n      addLog(content, thread, \"error\");\n    },\n  });\n\n  const consoleWrapper = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_card\", { others: \"debug\" }),\n  });\n  const consoleTitle = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_header-buttons\"),\n  });\n  const consoleText = Object.assign(document.createElement(\"h1\"), {\n    innerText: msg(\"console\"),\n  });\n  const extraContainer = Object.assign(document.createElement(\"div\"), {\n    className: `extra-log-container`,\n  });\n\n  const goToBlock = (targetId, blockId) => {\n    const workspace = Blockly.getMainWorkspace();\n\n    const offsetX = 32,\n      offsetY = 32;\n    if (targetId !== vm.editingTarget.id) {\n      // note: this is O(n) so don't call it if unnecessary!\n      if (vm.runtime.getTargetById(targetId)) {\n        vm.setEditingTarget(targetId);\n        // Should not cause recursion\n        setTimeout(() => goToBlock(targetId, blockId), 300);\n      }\n      return;\n    }\n    const block = workspace.getBlockById(blockId);\n    if (!block) return;\n\n    // Don't scroll to blocks in the flyout\n    if (block.workspace.isFlyout) return;\n\n    // Make sure the code tab is active\n    if (addon.tab.redux.state.scratchGui.editorTab.activeTabIndex !== 0) {\n      addon.tab.redux.dispatch({\n        type: \"scratch-gui/navigation/ACTIVATE_TAB\",\n        activeTabIndex: 0,\n      });\n      setTimeout(() => goToBlock(targetId, blockId), 0);\n      return;\n    }\n\n    // Copied from devtools. If it's code gets improved for this function, bring those changes here too.\n    let root = block.getRootBlock();\n\n    let base = block;\n    while (base.getOutputShape() && base.getSurroundParent()) {\n      base = base.getSurroundParent();\n    }\n\n    let ePos = base.getRelativeToSurfaceXY(), // Align with the top of the block\n      rPos = root.getRelativeToSurfaceXY(), // Align with the left of the block 'stack'\n      scale = workspace.scale,\n      x = rPos.x * scale,\n      y = ePos.y * scale,\n      xx = block.width + x, // Turns out they have their x & y stored locally, and they are the actual size rather than scaled or including children...\n      yy = block.height + y,\n      s = workspace.getMetrics();\n    if (\n      x < s.viewLeft + offsetX - 4 ||\n      xx > s.viewLeft + s.viewWidth ||\n      y < s.viewTop + offsetY - 4 ||\n      yy > s.viewTop + s.viewHeight\n    ) {\n      let sx = x - s.contentLeft - offsetX,\n        sy = y - s.contentTop - offsetY;\n\n      workspace.scrollbar.set(sx, sy);\n    }\n    // Flashing\n    const myFlash = { block: null, timerID: null, colour: null };\n    if (myFlash.timerID > 0) {\n      clearTimeout(myFlash.timerID);\n      myFlash.block.setColour(myFlash.colour);\n    }\n\n    let count = 4;\n    let flashOn = true;\n    myFlash.colour = block.getColour();\n    myFlash.block = block;\n\n    function _flash() {\n      if (!myFlash.block.svgPath_) {\n        myFlash.timerID = count = 0;\n        flashOn = true;\n        return;\n      }\n      myFlash.block.svgPath_.style.fill = flashOn ? \"#ffff80\" : myFlash.colour;\n      flashOn = !flashOn;\n      count--;\n      if (count > 0) {\n        myFlash.timerID = setTimeout(_flash, 200);\n      } else {\n        myFlash.timerID = 0;\n      }\n    }\n\n    _flash();\n  };\n  extraContainer.addEventListener(\"click\", (e) => {\n    const elem = e.target;\n    if (elem.classList.contains(\"deletedTarget\")) return;\n    const targetId = elem.dataset.targetId;\n    const blockId = elem.dataset.blockId;\n    if (targetId && blockId) goToBlock(targetId, blockId);\n  });\n  const consoleList = Object.assign(document.createElement(\"div\"), {\n    className: \"logs\",\n  });\n  const buttons = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_header-buttons-right\"),\n  });\n\n  const unpauseButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\", { others: \"sa-debugger-unpause\" }),\n    draggable: false,\n  });\n  const unpauseImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/play.svg\"),\n  });\n  const unpauseText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"unpause\"),\n  });\n\n  const exportButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\"),\n    title: msg(\"export-desc\"),\n    draggable: false,\n  });\n  const exportImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/download-white.svg\"),\n  });\n  const exportText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"export\"),\n  });\n\n  const trashButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_shrink-expand-button\"),\n    draggable: false,\n  });\n  const trashImg = Object.assign(document.createElement(\"img\"), {\n    src: _twGetAsset(\"/delete.svg\"),\n  });\n  const trashText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"clear\"),\n  });\n\n  const closeButton = Object.assign(document.createElement(\"div\"), {\n    className: addon.tab.scratchClass(\"card_remove-button\"),\n    draggable: false,\n  });\n  const closeImg = Object.assign(document.createElement(\"img\"), {\n    className: addon.tab.scratchClass(\"close-button_close-icon\"),\n    src: _twGetAsset(\"/add.svg\"),\n  });\n  const closeText = Object.assign(document.createElement(\"span\"), {\n    innerText: msg(\"close\"),\n  });\n\n  consoleTitle.append(consoleText, buttons);\n  buttons.append(unpauseButton, exportButton, trashButton, closeButton);\n  trashButton.append(trashImg, trashText);\n  closeButton.append(closeImg, closeText);\n  exportButton.append(exportImg, exportText);\n  unpauseButton.append(unpauseImg, unpauseText);\n  extraContainer.append(consoleList);\n  consoleWrapper.append(consoleTitle, extraContainer);\n  document.body.append(consoleWrapper);\n\n  consoleTitle.addEventListener(\"mousedown\", dragMouseDown);\n\n  let isScrolledToEnd = true;\n  extraContainer.addEventListener(\n    \"wheel\",\n    (e) => {\n      // When user scrolls up, stop automatically scrolling down\n      if (e.deltaY < 0) {\n        isScrolledToEnd = false;\n      }\n    },\n    { passive: true }\n  );\n  extraContainer.addEventListener(\n    \"scroll\",\n    () => {\n      isScrolledToEnd = extraContainer.scrollTop + 5 >= extraContainer.scrollHeight - extraContainer.clientHeight;\n    },\n    { passive: true }\n  );\n\n  const getTargetInfo = (id, cache = null) => {\n    if (cache && cache[id]) return cache[id];\n    const target = vm.runtime.getTargetById(id);\n    let item;\n    if (target) {\n      item = { name: target.getName(), isDeleted: false };\n    } else {\n      item = { name: msg(\"deleted-sprite\"), isDeleted: true };\n    }\n    if (cache) cache[id] = item;\n    return item;\n  };\n\n  let mouseOffsetX = 0;\n  let mouseOffsetY = 0;\n  let lastX = 0;\n  let lastY = 0;\n\n  function dragMouseDown(e) {\n    e.preventDefault();\n    mouseOffsetX = e.clientX - consoleWrapper.offsetLeft;\n    mouseOffsetY = e.clientY - consoleWrapper.offsetTop;\n    lastX = e.clientX;\n    lastY = e.clientY;\n    document.addEventListener(\"mouseup\", closeDragElement);\n    document.addEventListener(\"mousemove\", elementDrag);\n  }\n\n  function dragConsole(x, y) {\n    lastX = x;\n    lastY = y;\n    const width = (document.documentElement.clientWidth || document.body.clientWidth) - 1;\n    const height = (document.documentElement.clientHeight || document.body.clientHeight) - 1;\n    const clampedX = Math.max(0, Math.min(x - mouseOffsetX, width - consoleWrapper.offsetWidth));\n    const clampedY = Math.max(0, Math.min(y - mouseOffsetY, height - consoleWrapper.offsetHeight));\n    consoleWrapper.style.left = clampedX + \"px\";\n    consoleWrapper.style.top = clampedY + \"px\";\n  }\n\n  function elementDrag(e) {\n    e.preventDefault();\n    dragConsole(e.clientX, e.clientY);\n  }\n\n  window.addEventListener(\"resize\", () => {\n    dragConsole(lastX, lastY);\n  });\n\n  function closeDragElement() {\n    // stop moving when mouse button is released:\n    document.removeEventListener(\"mouseup\", closeDragElement);\n    document.removeEventListener(\"mousemove\", elementDrag);\n  }\n\n  trashButton.addEventListener(\"click\", () => {\n    document.querySelectorAll(\".log\").forEach((log, i) => log.remove());\n    closeDragElement();\n    logs = [];\n    isScrolledToEnd = true;\n  });\n  trashButton.addEventListener(\"mouseup\", () => {\n    closeDragElement();\n  });\n  closeButton.addEventListener(\"click\", () => toggleConsole(false));\n  closeButton.addEventListener(\"mouseup\", () => closeDragElement());\n  let download = (filename, text) => downloadBlob(filename, new Blob([text], { type: \"text/plain\" }));\n\n  unpauseButton.addEventListener(\"click\", () => setPaused(false));\n  if (!paused) unpauseButton.style.display = \"none\";\n  onPauseChanged((newPauseValue) => (unpauseButton.style.display = newPauseValue ? \"\" : \"none\"));\n\n  exportButton.addEventListener(\"click\", (e) => {\n    const defaultFormat = \"{sprite}: {content} ({type})\";\n    const exportFormat = e.shiftKey ? prompt(msg(\"enter-format\"), defaultFormat) : defaultFormat;\n    if (!exportFormat) return;\n    closeDragElement();\n    const targetInfoCache = Object.create(null);\n    let file = logs\n      .map(({ targetId, type, content }) =>\n        exportFormat.replace(\n          /\\{(sprite|type|content)\\}/g,\n          (_, match) =>\n            ({\n              sprite: getTargetInfo(targetId, targetInfoCache).name,\n              type,\n              content,\n            }[match])\n        )\n      )\n      .join(\"\\n\");\n    download(\"logs.txt\", file);\n  });\n  let logs = [];\n  let scrollQueued = false;\n  const createLogWrapper = (type) => {\n    const wrapper = document.createElement(\"div\");\n    wrapper.className = \"log\";\n    wrapper.classList.add(type);\n    return wrapper;\n  };\n  const createLogText = (text) => {\n    const s = document.createElement(\"span\");\n    s.innerText = text;\n    return s;\n  };\n\n  const addLog = (content, thread, type) => {\n    const wrapper = createLogWrapper(type);\n\n    const target = thread.target;\n    const parentTarget = target.isOriginal ? target : target.sprite.clones[0];\n    const targetId = parentTarget.id;\n    consoleList.append(wrapper);\n    if (type !== \"log\") {\n      const imageURL = _twGetAsset((type === \"error\" ? \"/error.svg\" : \"/warning.svg\"));\n      const icon = document.createElement(\"img\");\n      icon.src = imageURL;\n      icon.alt = icon.title = msg(\"icon-\" + type);\n      icon.className = \"logIcon\";\n      wrapper.appendChild(icon);\n    }\n\n    const blockId = thread.peekStack();\n    const block = target.blocks.getBlock(blockId);\n    if (block && ScratchBlocks) {\n      const inputId = Object.values(block.inputs)[0]?.block;\n      const inputBlock = target.blocks.getBlock(inputId);\n      if (inputBlock && inputBlock.opcode !== \"text\") {\n        let text, category;\n        if (\n          inputBlock.opcode === \"data_variable\" ||\n          inputBlock.opcode === \"data_listcontents\" ||\n          inputBlock.opcode === \"argument_reporter_string_number\" ||\n          inputBlock.opcode === \"argument_reporter_boolean\"\n        ) {\n          text = Object.values(inputBlock.fields)[0].value;\n          if (inputBlock.opcode === \"data_variable\") {\n            category = \"data\";\n          } else if (inputBlock.opcode === \"data_listcontents\") {\n            category = \"list\";\n          } else {\n            category = \"more\";\n          }\n        } else {\n          // Try to call things like https://github.com/LLK/scratch-blocks/blob/develop/blocks_vertical/operators.js\n          let jsonData;\n          const fakeBlock = {\n            jsonInit(data) {\n              jsonData = data;\n            },\n          };\n          const blockConstructor = ScratchBlocks.Blocks[inputBlock.opcode];\n          if (blockConstructor) {\n            try {\n              blockConstructor.init.call(fakeBlock);\n            } catch (e) {\n              // ignore\n            }\n          }\n          // If the block has a simple message with no arguments, display it\n          if (jsonData && jsonData.message0 && !jsonData.args0) {\n            text = jsonData.message0;\n            category = jsonData.category;\n          }\n        }\n        if (text && category) {\n          const blocklyColor = ScratchBlocks.Colours[category === \"list\" ? \"data_lists\" : category];\n          if (blocklyColor) {\n            const inputSpan = document.createElement(\"span\");\n            inputSpan.textContent = text;\n            inputSpan.className = \"console-variable\";\n            const colorCategoryMap = {\n              list: \"data-lists\",\n              more: \"custom\",\n            };\n            inputSpan.dataset.category = colorCategoryMap[category] || category;\n            inputSpan.style.backgroundColor = blocklyColor.primary;\n            wrapper.append(inputSpan);\n          }\n        }\n      }\n    }\n    logs.push({\n      targetId,\n      type,\n      content,\n    });\n    wrapper.append(createLogText(content));\n\n    let link = document.createElement(\"a\");\n    link.textContent = target.isOriginal\n      ? target.getName()\n      : msg(\"clone-of\", {\n          spriteName: parentTarget.getName(),\n        });\n    link.className = \"logLink\";\n    link.dataset.blockId = blockId;\n    link.dataset.targetId = targetId;\n    if (!target.isOriginal) {\n      link.dataset.isClone = \"true\";\n    }\n\n    wrapper.appendChild(link);\n\n    if (!scrollQueued && isScrolledToEnd) {\n      scrollQueued = true;\n      queueMicrotask(scrollToEnd);\n    }\n    if (!showingConsole) {\n      const unreadImage = _twGetAsset(\"/debug-unread.svg\");\n      if (buttonImage.src !== unreadImage) buttonImage.src = unreadImage;\n    }\n  };\n  const scrollToEnd = () => {\n    scrollQueued = false;\n    extraContainer.scrollTop = extraContainer.scrollHeight;\n  };\n  const toggleConsole = (show = !showingConsole) => {\n    showingConsole = show;\n    consoleWrapper.style.display = show ? \"flex\" : \"\";\n    if (show) {\n      buttonImage.src = _twGetAsset(\"/debug.svg\");\n      const cacheObj = Object.create(null);\n      for (const logLinkElem of document.getElementsByClassName(\"logLink\")) {\n        const targetId = logLinkElem.dataset.targetId;\n        if (!targetId) return;\n        const tInfo = getTargetInfo(targetId, cacheObj);\n        logLinkElem.textContent = tInfo.name;\n        if (tInfo.isDeleted) {\n          logLinkElem.classList.add(\"deletedTarget\");\n        } else if (logLinkElem.dataset.isClone) {\n          logLinkElem.textContent = msg(\"clone-of\", { spriteName: tInfo.name });\n        }\n      }\n      if (isScrolledToEnd) {\n        scrollToEnd();\n      }\n    }\n  };\n\n  if (addon.tab.redux.state && addon.tab.redux.state.scratchGui.stageSize.stageSize === \"small\") {\n    document.body.classList.add(\"sa-debugger-small\");\n  }\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      if (e.target.closest(\"[class*='stage-header_stage-button-first']\")) {\n        document.body.classList.add(\"sa-debugger-small\");\n      } else if (e.target.closest(\"[class*='stage-header_stage-button-last']\")) {\n        document.body.classList.remove(\"sa-debugger-small\");\n      }\n    },\n    { capture: true }\n  );\n\n  while (true) {\n    await addon.tab.waitForElement('[class*=\"stage-header_stage-size-row\"]', {\n      markAsSeen: true,\n      reduxEvents: [\n        \"scratch-gui/mode/SET_PLAYER\",\n        \"scratch-gui/mode/SET_FULL_SCREEN\",\n        \"fontsLoaded/SET_FONTS_LOADED\",\n        \"scratch-gui/locales/SELECT_LOCALE\",\n      ],\n    });\n    if (addon.tab.editorMode === \"editor\") {\n      ScratchBlocks = await addon.tab.traps.getBlockly();\n      addon.tab.appendToSharedSpace({ space: \"stageHeader\", element: container, order: 0 });\n    } else {\n      toggleConsole(false);\n    }\n  }\n}\n","// From https://github.com/LLK/scratch-gui/blob/develop/src/lib/download-blob.js\nexport default (filename, blob) => {\n  const downloadLink = document.createElement(\"a\");\n  document.body.appendChild(downloadLink);\n\n  // Use special ms version if available to get it working on Edge.\n  if (navigator.msSaveOrOpenBlob) {\n    navigator.msSaveOrOpenBlob(blob, filename);\n    return;\n  }\n\n  if (\"download\" in HTMLAnchorElement.prototype) {\n    const url = window.URL.createObjectURL(blob);\n    downloadLink.href = url;\n    downloadLink.download = filename;\n    downloadLink.type = blob.type;\n    downloadLink.click();\n    // remove the link after a timeout to prevent a crash on iOS 13 Safari\n    window.setTimeout(() => {\n      document.body.removeChild(downloadLink);\n      window.URL.revokeObjectURL(url);\n    }, 1000);\n  } else {\n    // iOS 12 Safari, open a new page and set href to data-uri\n    let popup = window.open(\"\", \"_blank\");\n    const reader = new FileReader();\n    reader.onloadend = function () {\n      popup.location.href = reader.result;\n      popup = null;\n    };\n    reader.readAsDataURL(blob);\n  }\n};\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AALA;AAQA;AACA;AAAA;AAAA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AACA;AAGA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AADA;AAEA;AAFA;AAAA;AAAA;AAAA;AAMA;AANA;AACA;AAOA;AAMA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AAAA;AAAA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAGA;AACA;AADA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAGA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAHA;AAQA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAMA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAKA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AAGA;AADA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAFA;AACA;AAQA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACniBA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;A","sourceRoot":""}